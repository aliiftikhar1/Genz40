{% extends "public/layout/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load frontend_custom_filters %}
{% block header %}

{% endblock %}

{% block content %}
 <!-- Hero Start -->
 <section class="bg-home d-flex align-items-center">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-7 col-md-6">
                <div class="me-lg-5">   
                    <img src="{% static 'images/user/recovery.svg' %}" class="img-fluid d-block mx-auto" alt="">
                </div>
            </div>
            <div class="col-lg-5 col-md-6">
                <div class="card shadow rounded border-0">
                    <div class="card-body">
                        <h4 class="card-title text-center">Sign In</h4>  
                        <form class="login-form mt-4" method="post" id="login-form">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="mb-3">
                                        <label class="form-label">Your Email <span class="text-danger">*</span></label>
                                        <div class="form-icon position-relative">
                                            <i data-feather="user" class="fea icon-sm icons"></i>
                                            <input type="text" class="form-control ps-5" placeholder="Email" name="username" required="">
                                        </div>
                                    </div>
                                </div><!--end col-->

                                <div class="col-lg-12">
                                    <div class="mb-3">
                                        <label class="form-label">Password <span class="text-danger">*</span></label>
                                        <div class="form-icon position-relative">
                                            <i data-feather="key" class="fea icon-sm icons"></i>
                                            <input type="password" name="password" class="form-control ps-5" placeholder="Password" required="">
                                        </div>
                                    </div>
                                </div><!--end col-->

                                <div class="col-lg-12">
                                    <div class="d-flex justify-content-between">
                                        <div class="mb-3">
                                            <!-- <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                                                <label class="form-check-label" for="flexCheckDefault">Remember me</label>
                                            </div> -->
                                        </div>
                                        <p class="forgot-pass mb-3"><a href="{% url 'password_reset' %}" class="text-dark fw-bold float-end">Forgot password ?</a></p>
                                    </div>
                                </div><!--end col-->

                                <div class="col-lg-12 mb-0">
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-success">Sign in
                                            <span class="spinner-border spinner-border-sm" id="pro1" role="status" aria-hidden="true" style="display: none;"></span>
                                        </button>
                                    </div>
                                </div><!--end col-->

                                <div class="col-12 text-center">
                                    <p class="mb-0 mt-3"><small class="text-dark me-2">Don't have an account ?</small> <a href="{% url 'register_page' %}" class="text-dark fw-bold">Sign Up</a></p>
                                </div><!--end col-->
                            </div><!--end row-->
                        </form>
                        <!-- <form class="login-form mt-4" method="post">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-lg-12">
                                    <p class="text-muted">Please enter your email address. You will receive a link to create a new password via email.</p>
                                    <div class="mb-3">
                                        <div class="form-icon position-relative">
                                            {{ form|crispy }}
                                            <div class="row">
                                                <div class="col-12 mt-2 mb-2">
                                                    <a href="{% url 'password_reset' %}">Forgot password?</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-success">Sign In</button>
                                    </div>
                                </div>
                                <div class="mx-auto">
                                    <p class="mb-0 mt-3"><a href="{% url 'register' %}" class="text-center">Register a new membership</a></p>
                                </div>
                            </div>
                        </form> -->
                    </div>
                </div>
            </div> <!--end col-->
        </div><!--end row-->
    </div> <!--end container-->
</section><!--end section-->
<!-- Hero End -->
{% endblock content %}

{% block script %}
<script>
    $("#login-form").submit(function (e) {
    event.preventDefault();
    var data = new FormData($('#login-form').get(0));
    $('#pro1').show();
        $.ajax({
            type: 'POST',
            url: "{% url 'customer_login' %}",
            data: data,
            cache: false,
            processData: false,
            contentType: false,
            crossDomain: true,
            success: function (response) {
                if (response.is_success) {
                    toastr.success(response.message);
                    location.href = "{% url 'dashboard' %}"
                } else {
                    toastr.error(response.message);
                }
                $('#login-form')[0].reset();
                $('#pro1').hide();
            },
            error: function (response) {
                // alert the error if any error occurred
                alert(response["error"]);
                $('#pro1').hide();
            }
        })
    })

</script>
<script>
$(document).ready(function() {
    setTimeout(function() {
        document.querySelector('.alert').remove();
    }, 5000);
});
</script>
{% endblock script %}
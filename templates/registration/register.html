<!-- templates/registration/register.html -->
{% extends "public/layout/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load frontend_custom_filters %}
{% block header %}
<style>
    body{
        background-color: #fff !important;
    }
    .shadow{
        box-shadow: 0 0 3px rgba(173,181,189,1)!important
    }

    #id_phone_number {
        padding-left: 50px !important;
    }
    .form-control{
        padding-left: 40px !important;
        padding-right: 40px !important;
        color: #000 !important;
        background-color: #fff !important;
    }

</style>
{% endblock %}

{% block content %}
 <!-- Hero Start -->
 <section class="bg-home d-flex align-items-center">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="card form-signin p-4 rounded shadow bg-dark">
                    <h4 class="card-title text-center text-light">Sign Up</h4>  
                        <form method="post" id="register-form" enctype="multipart/form-data">
                            {% csrf_token %}
                            <input type="text" value="{{ random_password }}" name="password1" hidden>
                            <input type="text" value="{{ random_password }}" name="password2" hidden>
                            <input type="text" value="{{ country_code }}" name="country" hidden>
                            <input type="text" value="customer" name="role" hidden>
                            <div class="row mt-4">
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label class="form-label text-light">First Name <span class="text-danger">*</span></label>
                                        <div class="form-icon position-relative">
                                            <i data-feather="user" class="fea icon-sm icons position-absolute text-light"></i>
                                            {{ form.first_name|without_label }}
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label class="form-label text-light">Last Name <span class="text-danger">*</span></label>
                                        <div class="form-icon position-relative">
                                            <i data-feather="user" class="fea icon-sm icons position-absolute text-light"></i>
                                            {{ form.last_name|without_label }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label class="form-label text-light">Email <span class="text-danger">*</span></label>
                                        <div class="form-icon position-relative">
                                            <i data-feather="mail" class="fea icon-sm icons position-absolute text-light"></i>
                                            {{ form.email|without_label }}
                                            {% if form.email.errors %}
                                                <div class="alert alert-danger mt-2">
                                                    {% for error in form.email.errors %}
                                                        <p>{{ error }}</p>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label class="form-label text-light">Phone Number <span class="text-danger">*</span></label>
                                        {{form.phone_number.errors}}
                                        <div class="form-icon position-relative">
                                            <img class="fea icon-sm icons" src="{{ country_flag_url }}" alt="Country Flag" style="width: 28px; height: 28px; top: 6px !important; left: 12px;">
                                            {{ form.phone_number|without_label }}
                                            {% if form.phone_number.errors %}
                                                <div class="alert alert-danger mt-2">
                                                    {% for error in form.phone_number.errors %}
                                                        <p>{{ error }}</p>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 mb-2">
                                    <label class="form-check-label text-light" for="flexCheckDefault">By continuing, you agree to our  <a href="{% url 'privacy_policy' %}" target="_blank" class="text-primary text-decoration-underline">Privacy Policy</a></label>
                                </div>

                                <div class="col-md-12 mb-0">
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-success">Sign Up
                                            <span class="spinner-border spinner-border-sm" id="pro" role="status" aria-hidden="true" style="display: none;"></span>
                                        </button>
                                    </div>
                                    <div class="mx-auto">
                                        <p class="mb-0 mt-3"><small class=" text-light me-2">Already have an account ?</small><a href="{% url 'customer_login' %}" class="text-primary fw-bold text-decoration-underline">Login</a></p>
                                    </div>
                                </div><!--end col-->
                            </div>
                            <!--end row-->
                        </form><!--end form-->
                </div>
            </div>
        </div>
    </div> <!--end container-->
</section>
{% endblock content %}

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("{{ form.email.id_for_label }}").removeAttribute("placeholder");
        document.getElementById("{{ form.first_name.id_for_label }}").removeAttribute("placeholder");
        document.getElementById("{{ form.last_name.id_for_label }}").removeAttribute("placeholder");
        document.getElementById("{{ form.phone_number.id_for_label }}").removeAttribute("placeholder");
    });
</script>
<script>
$(document).ready(function() {
    setTimeout(function() {
        document.querySelector('.alert').remove();
    }, 5000);
});
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let phoneInput = document.getElementById("{{ form.phone_number.id_for_label }}"); // Get the form field
    
        if (phoneInput) {
            phoneInput.addEventListener("input", function (e) {
                let value = e.target.value.replace(/\D/g, ""); // Remove non-numeric characters
    
                if (value.length > 10) value = value.substring(0, 10); // Limit to 10 digits
    
                let formattedValue = value;
    
                if (value.length > 6) {
                    formattedValue = `(${value.substring(0, 3)}) ${value.substring(3, 6)}-${value.substring(6)}`;
                } else if (value.length > 3) {
                    formattedValue = `(${value.substring(0, 3)}) ${value.substring(3)}`;
                } else if (value.length > 0) {
                    formattedValue = `(${value}`;
                }
    
                e.target.value = formattedValue;
            });
        }
    });
    </script>
<script>
    $("#register-form").submit(function (e) {
    event.preventDefault();
    var data = new FormData($('#register-form').get(0));
    $('#pro').show();
        $.ajax({
            type: 'POST',
            url: "{% url 'customer_register' %}",
            data: data,
            cache: false,
            processData: false,
            contentType: false,
            crossDomain: true,
            success: function (response) {
                if (response.is_success) {
                    toastr.success(response['message']);
                    setTimeout(function() {
                        location.href = "{% url 'customer_login' %}";
                    }, 3000);
                    
                    $('#login-form')[0].reset();
                } else {
                    toastr.error(response['message']);
                }
                $('#pro').hide();
            },
            error: function (response) {
                if (!response.is_success) {
                    toastr.error(response['message']);
                }
                // alert the error if any error occurred
                $('#pro').hide();
            }
        })
    })

</script>

{% endblock script %}
